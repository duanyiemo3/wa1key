# wa1key3.0教程指南

## 常见问题

#### 实现原理
wa1key通过使用WeakAuras插件获取游戏内属性，并通过在游戏顶部渲染1个像素的横线（这也是为什么不能遮挡游戏标题栏的原因）来显示内部属性值，wa1key会通过每秒100次的速度去扫描这条线，读取到所需的数据，然后通过lua脚本运行定义的逻辑，最后发送对应的物理按键指令，实现自动自动按键的效果。

#### 安全性
wa1key是没有使用任何注入、hook技术，而是使用类似视觉模拟和物理输入方式实现自动按键，理论上跟人工手打没有区别，所以不存在因为游戏检测和识别原因导致封禁的风险，但如果你写的逻辑太过变态，仍有可能引起队友或围观者不满，进而举报你导致封禁，请酌情使用。

#### 提示找不到WeakAuras插件
wa1key依赖WeakAuras插件，所以在使用前请先安装好WeakAuras插件。（测试方法 在游戏中 /wa 能唤出Wa界面表示已经安装好）

#### 提示”等待于WeakAuras插件通讯"
请按照以下流程尝试
1. 启动游戏
2. 启动wakey
3. 选择或切换一个wa1key模块
4. 进入游戏、重载（/reload ui)
5. 如果还不行，重复以上步骤

## 如何制作属于自己的模块

#### 新建一个模块

1. 启动wa1key
2. 点击 模块编辑
3. 给你的模块名称起一个名字
4. 选择你需要设计的模块的职业
5. 保存即可完成创建

#### 编辑一个模块

1. 用上一步的步骤打开一个模块
2. 编辑器分 `属性` `宏` `逻辑` 三个部分 其中

| 界面  |描述 |
| ------- | ----------------------- |
| 属性 |表示你需要从游戏内获取到的属性值|
| 宏 |表示你需要定义的宏（跟游戏内的语法一摸一样 |
| 逻辑 |表示你需要实现的模块逻辑 |

#### 属性如何定义
属性有3个字段需要定义，分别表示

| 字段  |描述 |
| ------- | ----------------------- |
| 名称 |这个名称表示你需要在在逻辑中使用的名字，可以是任意字符，例如`自身血量`|
| 属性 |这个选项表示你需要获取的游戏内的属性类型，例如`自身血量百分比`|
| 值 |有些属性是需要额外填写一个对应的值才能获取，例如`自身Buff时间`就需要在值里填入该buff的id或者中文名（中文属性需要使用半角引号`"`包围，否则无法填写)，例如`"暗影冥思"`|

#### 宏如何定义
宏有2个字段需要定义，分别表示

| 字段  |描述 |
| ------- | ----------------------- |
| 名称 |这个名称表示你需要在在逻辑中使用的名字，可以是任意字符，例如`暗影箭`|
| 值 |这个表示你的宏内容，这个宏跟游戏内的一摸一样，如果需要换行，请用`\n`表示，示例:`/cast 暗影箭`|

#### 逻辑如何定义
逻辑有1个字段需要定义，分别表示

| 字段  |描述 |
| ------- | ----------------------- |
| 名称 |这个名称表示你的逻辑名称，这个会出现在模块的逻辑选择栏中|
> 逻辑的具体代码，请直接双击该逻辑，进入代码编辑器。

## 逻辑编辑

##### 支持的API

| API  |描述 |
| ------- | ----------------------- |
| Prop |获取属性，参数是`属性`栏定义的名称，例如`Prop("自身血量")`|
| Cast |运行宏，参数是`宏`栏定义的名称，例如`Cast("暗影箭")`|
| CoolDown |表示冷却时间，值单位是冷却名和冷却时间（毫秒），例如`CollDown("日蚀冷却",1000)`|
| Select |选择目标，参数是目标ID，目标ID一般通过特定的属性值获取，例如`Select(Prop("全团血量最低"))`|
| Sleep |休眠等待，参数是毫秒，表示原地等待指定毫秒数的时间，例如`Sleep(1000)`|
| PressKey |按下指定按键，参数是按键ID，按键表参见 [虚拟键码](https://learn.microsoft.com/zh-cn/windows/win32/inputdev/virtual-key-codes) )|
> 除以上自定义API之外，还支持全部Lua标准语法和API，可以自行组合

#### 示例
```lua
Cast("开打")


if CoolDown("宠物攻击", 1500) then
    Cast("宠物攻击")
end


if (Prop("生命分流") < 5 and Prop("目标血量") > 25) or Prop("蓝量") < 5 then
    Cast("生命分流")
end

-- 非斩杀阶段
if Prop("目标血量") > 25 then
    
    -- 准备斩杀时，保持50%以上蓝量
    if Prop("目标血量") < 35 and Prop("目标实际血量") > 100 and Prop("蓝量") < 50 then
        Cast("生命分流")
    end
    
    -- 小于35%时刷新腐蚀术，30秒冷却
    if Prop("目标血量") <= 35 then
        if CoolDown("35斩杀", 30 * 1000) then
            Cast("腐蚀术")
        end
    end
    
    if (Prop("暗影掌握") == 0 or Prop("暗影之拥") == 0) and Prop("暗影箭计时") > 10 then
        Cast("暗影箭2")
        return
    end
    
    
    if Prop("鬼影缠身") <= 3 then
        Cast("鬼影缠身")
    end
    
    -- 有暗影冥思就打暗影箭
    if Prop("暗影冥思") > 0 then
        Cast("暗影箭")
    end
    
    if Prop("痛苦无常") <= 2 then
        Cast("痛苦无常")
    end
    
    
    if Prop("腐蚀术") < 1 and (Prop("暗影之拥") > 0 or Prop("暗影掌握") > 0) and Prop("鬼影缠身") then
        Cast("腐蚀术")
    end
    
    if Prop("痛苦诅咒") == 0 and (Prop("暗影之拥") > 0 or Prop("暗影掌握") > 0) and Prop("鬼影缠身") then
        Cast("痛苦诅咒")
    end
    
    
    if Prop("鬼影缠身") * 100 - Prop("暗影箭施法时间") > 250 then
        Cast("暗影箭")
    end

else
    -- 直接打断所有暗影箭
    if Prop("自身施法代码") == 124 then
        Cast("停止施法")
        return
    end
    
    -- 有暗影冥思就打暗影箭
    if Prop("暗影冥思") > 0 then
        Cast("暗影箭")
    end
    
    -- 在灵魂吸取时，其他事都不干
    if Prop("自身施法进度") > 0 and Prop("自身施法代码") == 170 then
        
        -- 当鬼影快结束时，在下个跳伤后立即停止施法,补鬼影
        if Prop("吸魂跳伤计时") <= 1 and Prop("鬼影缠身") <= 3 then
            Cast("停止施法")
        end
        
        if Prop("吸魂跳伤计时") <= 1 and Prop("暗影冥思") > 0 then
            Cast("暗影箭")
        end
        
        return
    end
    
    if Prop("鬼影缠身") <= 3 then
        Cast("鬼影缠身")
    end
    
    if Prop("痛苦无常") <= 2 then
        Cast("痛苦无常")
    end
    
    
    Cast("吸取灵魂")


end
```

#### 讨论交流

更多交流或讨论可以进入我们的dc一起讨论，也欢迎各位大佬有时间完善、更新此表格，我会第一时间合并

https://discord.com/invite/9z7Ubbabpg



